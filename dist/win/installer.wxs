<?xml version='1.0' encoding='windows-1252'?>
<Wix xmlns='http://schemas.microsoft.com/wix/2006/wi'>

  <?define ProductName = "Tiled" ?>
  <?define Manufacturer = "mapeditor.org" ?>
  <?define UpgradeCode = "F7EEDD05-BBFC-4D6A-9BF6-98D3BA77F327" ?>
  <?define WebsiteURL="https://www.mapeditor.org/" ?>

  <?ifndef InstallRoot ?>
    <?error InstallRoot must be defined ?>
  <?endif?>
  <?ifndef QtDir ?>
    <?error QtDir must be defined ?>
  <?endif?>
  <?ifndef RootDir ?>
    <?error RootDir must be defined ?>
  <?endif?>
  <?ifndef Version ?>
    <?error Version must be defined ?>
  <?endif?>
  <?ifndef Platform ?>
    <?error Platform must be defined ?>
  <?endif?>

  <?if $(var.Platform) = x64 ?>
    <?define PlatformProgramFilesFolder = "ProgramFiles64Folder" ?>
  <?else ?>
    <?define PlatformProgramFilesFolder = "ProgramFilesFolder" ?>
  <?endif ?>

  <Product Name='$(var.ProductName)' Id="*"
           UpgradeCode="$(var.UpgradeCode)" 
           Language='1033' Codepage='1252' Version='$(var.Version)' Manufacturer='$(var.Manufacturer)'>

    <Package Id='*' Keywords='Installer' Description="[ProductName] Installer"
             Comments='Windows Installer Package' Manufacturer='[Manufacturer]'
             Languages='1033' Compressed='yes' SummaryCodepage='1252'
             InstallScope='perMachine' />

    <MajorUpgrade AllowDowngrades="yes" />

    <!-- Set properties for add/remove programs -->
    <Property Id="ARPPRODUCTICON" Value="tiled.exe" />
    <Property Id="ARPURLINFOABOUT" Value="$(var.WebsiteURL)" />
    <Property Id="ARPNOREPAIR" Value="yes" Secure="yes" />      <!-- Remove repair -->

    <Media Id='1' Cabinet='files.cab' EmbedCab='yes' DiskPrompt="CD-ROM #1" CompressionLevel="high" />
    <Property Id='DiskPrompt' Value="Tiled Installation [1]" />

    <!-- Save the command line value INSTALLDIR and restore it later in the sequence or it will be overwritten by the value saved to the registry during an upgrade -->
    <!-- https://robmensching.com/blog/posts/2010/5/2/the-wix-toolsets-remember-property-pattern/ -->
    <CustomAction Id='SaveCmdLineValueINSTALLDIR' Property='CMDLINE_INSTALLDIR' Value='[INSTALLDIR]' Execute='firstSequence' />
    <CustomAction Id='SetFromCmdLineValueINSTALLDIR' Property='INSTALLDIR' Value='[CMDLINE_INSTALLDIR]' Execute='firstSequence' />
    <InstallUISequence>
      <Custom Action='SaveCmdLineValueINSTALLDIR' Before='AppSearch' />
      <Custom Action='SetFromCmdLineValueINSTALLDIR' After='AppSearch'>
        CMDLINE_INSTALLDIR
      </Custom>
    </InstallUISequence>
    <InstallExecuteSequence>
      <Custom Action='SaveCmdLineValueINSTALLDIR' Before='AppSearch' />
      <Custom Action='SetFromCmdLineValueINSTALLDIR' After='AppSearch'>
        CMDLINE_INSTALLDIR
      </Custom>
    </InstallExecuteSequence>

    <Property Id="INSTALLDIR">
      <RegistrySearch Id='DetermineInstallLocation' Type='raw' Root='HKLM' Key='Software\[Manufacturer]\[ProductName]' Name='InstallDir' />
    </Property>

    <Directory Id='TARGETDIR' Name='SourceDir'>
      <Directory Id='$(var.PlatformProgramFilesFolder)' Name='PFiles'>
        <Directory Id='INSTALLDIR' Name='Tiled'>

          <Component Id='MainExecutable' Guid='{4DC82B82-E1A7-4829-92CC-2BEB40E361BD}'>
            <File Source='$(var.InstallRoot)\tiled.exe' KeyPath='yes' Checksum='yes'>
              <Shortcut Id="startmenuTiled" Directory="ProgramMenuFolder" Name="Tiled" WorkingDirectory='INSTALLDIR' Icon="tiled.exe" IconIndex="0" Advertise="yes" />
              <Shortcut Id="desktopTiled" Directory="DesktopFolder" Name="Tiled" WorkingDirectory='INSTALLDIR' Icon="tiled.exe" IconIndex="0" Advertise="yes" />
            </File>
            <File Source="$(var.InstallRoot)\terraingenerator.exe" />
            <File Source="$(var.InstallRoot)\tiled.dll" />
            <File Source="$(var.InstallRoot)\tmxrasterizer.exe" />
            <File Source="$(var.InstallRoot)\tmxviewer.exe" />
            <File Source="$(var.RootDir)\dist\win\qt.conf" />
            <File Source="$(var.QtDir)\bin\Qt5Core.dll"/>
            <File Source="$(var.QtDir)\bin\Qt5Gui.dll"/>
            <File Source="$(var.QtDir)\bin\Qt5Network.dll"/>
            <File Source="$(var.QtDir)\bin\Qt5Qml.dll"/>
            <File Source="$(var.QtDir)\bin\Qt5Svg.dll"/>
            <File Source="$(var.QtDir)\bin\Qt5Widgets.dll"/>

            <?ifdef MingwDir ?>
              <?if $(var.Platform) = x64 ?>
                <File Source="$(var.MingwDir)\bin\libgcc_s_seh-1.dll"/>
              <?else ?>
                <File Source="$(var.MingwDir)\bin\libgcc_s_dw2-1.dll"/>
              <?endif ?>
              <File Source="$(var.MingwDir)\bin\libstdc++-6.dll"/>
              <File Source="$(var.MingwDir)\bin\libwinpthread-1.dll"/>
            <?else?>
              <?ifdef VcUniversalCRT ?>
                <File Source="$(var.VcInstallDir)\msvcp140.dll"/>
              <?else?>
                <File Source="$(var.VcInstallDir)\redist\$(var.Platform)\Microsoft.VC120.CRT\msvcp120.dll"/>
                <File Source="$(var.VcInstallDir)\redist\$(var.Platform)\Microsoft.VC120.CRT\msvcr120.dll"/>
              <?endif?>
            <?endif?>

            <?ifdef OpenSsl102Dir ?>
              <File Source="$(var.OpenSsl102Dir)\libeay32.dll" />
              <File Source="$(var.OpenSsl102Dir)\ssleay32.dll" />
            <?endif?>

            <?ifdef OpenSsl111Dir ?>
              <?if $(var.Platform) = x64 ?>
                <File Source="$(var.OpenSsl111Dir)\libcrypto-1_1-x64.dll" />
                <File Source="$(var.OpenSsl111Dir)\libssl-1_1-x64.dll" />
              <?else?>
                <File Source="$(var.OpenSsl111Dir)\libcrypto-1_1.dll" />
                <File Source="$(var.OpenSsl111Dir)\libssl-1_1.dll" />
              <?endif?>
            <?endif?>

            <File Name="COPYING.txt" Source="$(var.RootDir)\COPYING"/>
            <File Name="AUTHORS.txt" Source="$(var.RootDir)\AUTHORS"/>
            <File Name="README.txt" Source="$(var.RootDir)\README.md"/>
            <File Name="NEWS.txt" Source="$(var.RootDir)\NEWS.md"/>
            <File Name="LICENSE.APACHE.txt" Source="$(var.RootDir)\LICENSE.APACHE"/>
            <File Name="LICENSE.BSD.txt" Source="$(var.RootDir)\LICENSE.BSD"/>
            <File Name="LICENSE.GPL.txt" Source="$(var.RootDir)\LICENSE.GPL"/>

            <RegistryKey Root='HKLM' Key='Software\[Manufacturer]\[ProductName]'>
              <RegistryValue Type='string' Name='InstallDir' Value='[INSTALLDIR]'/>
            </RegistryKey>

            <!-- Associated Tiled with .tmx files -->
            <ProgId Id='Tiled.tmx' Description='Tiled map file' Icon='tiled.exe'>
              <Extension Id='tmx' ContentType='application/x-tiled-tmx'>
                <Verb Id='open' Command='Open' TargetFile='tiled.exe' Argument='"%1"' />
              </Extension>
            </ProgId>
          </Component>

          <Directory Id="dir83A7B7C3F39E24970C38654C9B6F4A12" Name="plugins">
            <Directory Id="dirED990048BCB522432182867E2817CD9B" Name="tiled">
              <Component Id="Plugins" Guid="{11ACEE38-A936-4FF4-BD8C-D1475D5454D1}">
                <File Source="$(var.InstallRoot)\plugins\tiled\csv.dll" />
                <File Source="$(var.InstallRoot)\plugins\tiled\defold.dll" />
                <File Source="$(var.InstallRoot)\plugins\tiled\defoldcollection.dll" />
                <File Source="$(var.InstallRoot)\plugins\tiled\droidcraft.dll" />
                <File Source="$(var.InstallRoot)\plugins\tiled\flare.dll" />
                <File Source="$(var.InstallRoot)\plugins\tiled\gmx.dll" />
                <File Source="$(var.InstallRoot)\plugins\tiled\json.dll" />
                <File Source="$(var.InstallRoot)\plugins\tiled\json1.dll" />
                <File Source="$(var.InstallRoot)\plugins\tiled\lua.dll" />

                <?ifdef Python ?>
                <File Source="$(var.InstallRoot)\plugins\tiled\python.dll" />
                <?endif?>

                <File Source="$(var.InstallRoot)\plugins\tiled\replicaisland.dll" />
                <File Source="$(var.InstallRoot)\plugins\tiled\tbin.dll" />
                <File Source="$(var.InstallRoot)\plugins\tiled\tengine.dll" />
              </Component>
            </Directory>
            <Directory Id="platformPlugins" Name="platforms">
              <Component Id="PlatformPlugins" Guid="{093AD7E9-DE6A-48F5-B40D-E260E3F6D4D5}">
                <File Source="$(var.QtDir)\plugins\platforms\qwindows.dll"/>
              </Component>
            </Directory>
            <Directory Id="iconEnginePlugins" Name="iconengines">
              <Component Id="IconEnginePlugins" Guid="{6087784F-C335-4EA6-A959-674E0D72F194}">
                <File Source="$(var.QtDir)\plugins\iconengines\qsvgicon.dll"/>
              </Component>
            </Directory>
            <Directory Id="imageFormatPlugins" Name="imageformats">
              <Component Id="ImageFormatPlugins" Guid="{C655A440-9F24-4489-8DB9-5A4EFF6EB5D7}">
                <File Source="$(var.QtDir)\plugins\imageformats\qgif.dll"/>
                <File Source="$(var.QtDir)\plugins\imageformats\qjpeg.dll"/>
                <File Source="$(var.QtDir)\plugins\imageformats\qsvg.dll"/>
                <File Source="$(var.QtDir)\plugins\imageformats\qtga.dll"/>
                <File Source="$(var.QtDir)\plugins\imageformats\qtiff.dll"/>
                <File Source="$(var.QtDir)\plugins\imageformats\qwbmp.dll"/>
                <File Source="$(var.QtDir)\plugins\imageformats\qwebp.dll"/>
              </Component>
            </Directory>
            <?ifdef WindowsVistaStyle ?>
            <Directory Id="stylePlugins" Name="styles">
              <Component Id="StylePlugins" Guid="{DB5D5DD3-1128-4FE0-A76C-EB7E4069EBFE}">
                <File Source="$(var.QtDir)\plugins\styles\qwindowsvistastyle.dll"/>
              </Component>
            </Directory>
            <?endif?>
          </Directory>

          <Directory Id="dir674F7F6D2030C2EBF39AA06B57EAF368" Name="translations">
            <Component Id="Translations" Guid="{EA6DC1E2-A2EB-4130-A482-231583226C08}">
              <!-- Tiled translations -->
              <File Source="$(var.InstallRoot)\translations\tiled_ar_DZ.qm" />
              <File Source="$(var.InstallRoot)\translations\tiled_bg.qm" />
              <File Source="$(var.InstallRoot)\translations\tiled_cs.qm" />
              <File Source="$(var.InstallRoot)\translations\tiled_de.qm" />
              <File Source="$(var.InstallRoot)\translations\tiled_en.qm" />
              <File Source="$(var.InstallRoot)\translations\tiled_es.qm" />
              <File Source="$(var.InstallRoot)\translations\tiled_fr.qm" />
              <File Source="$(var.InstallRoot)\translations\tiled_he.qm" />
              <File Source="$(var.InstallRoot)\translations\tiled_it.qm" />
              <File Source="$(var.InstallRoot)\translations\tiled_ja.qm" />
              <File Source="$(var.InstallRoot)\translations\tiled_nb.qm" />
              <File Source="$(var.InstallRoot)\translations\tiled_nl.qm" />
              <File Source="$(var.InstallRoot)\translations\tiled_pl.qm" />
              <File Source="$(var.InstallRoot)\translations\tiled_pt.qm" />
              <File Source="$(var.InstallRoot)\translations\tiled_pt_PT.qm" />
              <File Source="$(var.InstallRoot)\translations\tiled_ru.qm" />
              <File Source="$(var.InstallRoot)\translations\tiled_tr.qm" />
              <File Source="$(var.InstallRoot)\translations\tiled_zh_CN.qm" />
              <File Source="$(var.InstallRoot)\translations\tiled_zh_TW.qm" />

              <!-- Qt translations -->
              <File Source="$(var.QtDir)\translations\qt_cs.qm"/>
              <File Source="$(var.QtDir)\translations\qt_de.qm"/>
              <File Source="$(var.QtDir)\translations\qt_es.qm"/>
              <File Source="$(var.QtDir)\translations\qt_fr.qm"/>
              <File Source="$(var.QtDir)\translations\qt_he.qm"/>
              <File Source="$(var.QtDir)\translations\qt_ja.qm"/>
              <File Source="$(var.QtDir)\translations\qt_pt.qm"/>
              <File Source="$(var.QtDir)\translations\qt_ru.qm"/>
              <File Source="$(var.QtDir)\translations\qt_zh_CN.qm"/>
              <File Source="$(var.QtDir)\translations\qt_zh_TW.qm"/>
            </Component>
          </Directory>
          <Directory Id="examples" Name="examples">
            <Component Id="Examples" Guid="{AC8FD854-A03C-475D-AE66-64428B43C8D7}">
              <File Source="$(var.RootDir)\examples\buch-outdoor.png" />
              <File Source="$(var.RootDir)\examples\desert.tmx" />
              <File Source="$(var.RootDir)\examples\desert.tsx" />
              <File Source="$(var.RootDir)\examples\hexagonal-mini.tmx" />
              <File Source="$(var.RootDir)\examples\hexmini.png" />
              <File Source="$(var.RootDir)\examples\isometric_grass_and_water.png" />
              <File Source="$(var.RootDir)\examples\isometric_grass_and_water.tmx" />
              <File Source="$(var.RootDir)\examples\orthogonal-outside.tmx" />
              <File Source="$(var.RootDir)\examples\perspective_walls.png" />
              <File Source="$(var.RootDir)\examples\perspective_walls.tmx" />
              <File Source="$(var.RootDir)\examples\perspective_walls.tsx" />
              <File Source="$(var.RootDir)\examples\sewers.tmx" />
              <File Source="$(var.RootDir)\examples\sewer_tileset.png" />
              <File Source="$(var.RootDir)\examples\tmw_desert_spacing.png" />
            </Component>
            <Directory Id="dir835E6648DA39D15AFC143959CBD1FC79" Name="sewer_automap">
              <Component Id="AutomappingExample" Guid="{46E8AEB0-C49F-430E-AA2C-210D3FE52198}">
                <File Source="$(var.RootDir)\examples\sewer_automap\rules.txt" />
                <File Source="$(var.RootDir)\examples\sewer_automap\rules_sewers.png" />
                <File Source="$(var.RootDir)\examples\sewer_automap\rule_001.tmx" />
                <File Source="$(var.RootDir)\examples\sewer_automap\rule_002.tmx" />
                <File Source="$(var.RootDir)\examples\sewer_automap\rule_003.tmx" />
                <File Source="$(var.RootDir)\examples\sewer_automap\rule_004.tmx" />
                <File Source="$(var.RootDir)\examples\sewer_automap\rule_005.tmx" />
                <File Source="$(var.RootDir)\examples\sewer_automap\rule_006.tmx" />
                <File Source="$(var.RootDir)\examples\sewer_automap\rule_007.tmx" />
                <File Source="$(var.RootDir)\examples\sewer_automap\rule_008.tmx" />
                <File Source="$(var.RootDir)\examples\sewer_automap\rule_009.tmx" />
                <File Id="automap_sewers.tmx" Source="$(var.RootDir)\examples\sewer_automap\sewers.tmx" />
              </Component>
            </Directory>
            <Directory Id="sticker_knight" Name="sticker-knight">
              <Component Id="StickerKnightExample" Guid="{6487C380-733E-42CD-8560-81046F945377}">
                <File Source="$(var.RootDir)\examples\sticker-knight\preview.png" />
                <File Source="$(var.RootDir)\examples\sticker-knight\README.md" />
                <File Source="$(var.RootDir)\examples\sticker-knight\sprites.png" />
              </Component>
              <Directory Id="sticker_knight_map" Name="map">
                <Component Id="StickerKnightExampleMap" Guid="{0CAE3CFE-7F15-4F08-9153-955E66F48623}">
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\alter.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\backgroundArch.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\backgroundMountain.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\backgroundTower.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\backgroundTree.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\blobBlue.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\blobGreen.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\blue.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\bombStroked.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\castleWall.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\cloud.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\column1.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\column2.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\doorBlueStroked.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\doorGreenStroke.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\doorRedStroked.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\doorStroked.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\earthWall.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\earthWall2.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\exit.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\flare.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\gemBlueStroked.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\gemRedStroked.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\grassLarge.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\grassSmall.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\grey.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\hero.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\keyGreenStroked.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\keyRedStroked.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\keyYellowStroked.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\platform1.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\platform2.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\platform3.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\platform4.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\platformBase1.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\platformBase2.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\platformBase3.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\platformBase4.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\platformBlock1.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\platformBlock2.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\platformBlock3.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\platformBlock4.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\platformConnector1.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\platformConnector2.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\platformConnector3.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\platformConnector4.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\pushBlock1.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\pushBlock2.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\pushBlock3.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\sandbox.tmx" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\sandbox2.tmx" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\shadow.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\shieldStroked.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\sign.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\skeleton.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\swordStroked.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\torch.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\trap.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\wallDecor1.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\wallDecor2.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\wallDecor3.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\window1.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\window2.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\map\window3.png" />
                </Component>
              </Directory>
              <Directory Id="sticker_knight_ui" Name="ui">
                <Component Id="StickerKnightExampleUi" Guid="{C8569B5C-20AF-482D-B46C-F20794BF646D}">
                  <File Source="$(var.RootDir)\examples\sticker-knight\ui\backgroundSet.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\ui\block.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\ui\buttonHelp.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\ui\buttonStart.png" />
                  <File Id="ui_cloud.png" Source="$(var.RootDir)\examples\sticker-knight\ui\cloud.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\ui\gem.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\ui\heart.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\ui\helpBackground.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\ui\shield.png" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\ui\title.json" />
                  <File Source="$(var.RootDir)\examples\sticker-knight\ui\title.png" />
                </Component>
              </Directory>
            </Directory>
            <Directory Id="python_plugin_example" Name="python">
              <Component Id="PythonPluginExample" Guid="{EF573450-60C9-4CDF-8E30-78AB4E60C647}">
                <File Source="$(var.RootDir)\src\plugins\python\scripts\fotf.py" />
                <File Source="$(var.RootDir)\src\plugins\python\scripts\mappy.py" />
                <File Source="$(var.RootDir)\src\plugins\python\scripts\pk2.py" />
                <File Source="$(var.RootDir)\src\plugins\python\scripts\zst.py" />
              </Component>
              <Directory Id="python_plugin_example_lib" Name="lib">
                <Component Id="PythonPluginExampleLib" Guid="{7421AD4B-061B-4475-B5F3-7E92747515AC}">
                  <File Source="$(var.RootDir)\src\plugins\python\scripts\lib\__init__.py" />
                  <File Source="$(var.RootDir)\src\plugins\python\scripts\lib\cpystruct.py" />
                  <File Source="$(var.RootDir)\src\plugins\python\scripts\lib\lbm.py" />
                  <File Source="$(var.RootDir)\src\plugins\python\scripts\lib\mappy_types.py" />
                </Component>
              </Directory>
            </Directory>
          </Directory>
        </Directory>
      </Directory>

      <Directory Id="ProgramMenuFolder" Name="Programs">
        <Component Id="ProgramMenuDir" Guid="{2A4BD742-9A41-40D5-B871-0585CCF9805D}">
          <RegistryValue Root='HKMU' Key='Software\[Manufacturer]\[ProductName]' Type='string' Value='' KeyPath='yes' />
        </Component>
      </Directory>

      <Directory Id="DesktopFolder" Name="Desktop" />
    </Directory>

    <Feature Id='Complete' Level='1' Title="Tiled" Description="The complete package." ConfigurableDirectory='INSTALLDIR' AllowAdvertise='no' Absent='disallow'>
      <ComponentRef Id='MainExecutable' />
      <ComponentRef Id='Plugins' />
      <ComponentRef Id='Translations' />
      <ComponentRef Id='Examples' />
      <ComponentRef Id='AutomappingExample' />
      <ComponentRef Id='StickerKnightExample' />
      <ComponentRef Id='StickerKnightExampleMap' />
      <ComponentRef Id='StickerKnightExampleUi' />
      <ComponentRef Id='PythonPluginExample' />
      <ComponentRef Id='PythonPluginExampleLib' />
      <ComponentRef Id='PlatformPlugins' />
      <ComponentRef Id='ImageFormatPlugins' />
      <ComponentRef Id='IconEnginePlugins' />
      <?ifdef WindowsVistaStyle ?>
      <ComponentRef Id='StylePlugins' />
      <?endif?>
      <ComponentRef Id='ProgramMenuDir' />
    </Feature>

    <!-- Set up ARPINSTALLLOCATION property (http://blogs.technet.com/b/alexshev/archive/2008/02/09/from-msi-to-wix-part-2.aspx) -->
    <CustomAction Id="SetARPINSTALLLOCATION" Property="ARPINSTALLLOCATION" Value="[INSTALLDIR]" />
    <CustomAction Id='LaunchApplication' FileKey='tiled.exe' ExeCommand='' Return='asyncNoWait' />

    <Property Id="WIXUI_INSTALLDIR">INSTALLDIR</Property>
    <UIRef Id="WixUI_InstallDir" />
    <UIRef Id="WixUI_ErrorProgressText" />

    <Icon Id="tiled.exe" SourceFile="$(var.InstallRoot)\tiled.exe" />

    <WixVariable Id="WixUILicenseRtf" Value="$(var.RootDir)\dist\win\gpl-2.0.rtf" />
    <WixVariable Id="WixUIBannerBmp" Value="$(var.RootDir)\dist\win\banner.bmp" />
    <WixVariable Id="WixUIDialogBmp" Value="$(var.RootDir)\dist\win\dialog.bmp" />

    <InstallExecuteSequence>
      <!-- Determine the install location after the install path has been validated by the installer -->
      <Custom Action="SetARPINSTALLLOCATION" After="InstallValidate"></Custom>
      <Custom Action='LaunchApplication' After='InstallFinalize'>NOT Installed</Custom>
    </InstallExecuteSequence>

  </Product>
</Wix>
